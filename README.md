[![Circle CI](https://circleci.com/gh/YouPers/yp-backend.png?style=badge&circle-token=567d4111261733d616e5f398ea7715e098f562b2)](https://circleci.com/gh/YouPers/yp-backend)

# Youpers Backend Platform



## Developing and building

### Prerequisites

#### Local Dependencies
Installed local mongoDb: http://www.mongodb.org/downloads
Installed nodejs und npm: http://nodejs.org/   or via homebrew  or probably best: https://github.com/creationix/nvm
Installed grunt cli: `npm install -g grunt-cli`
Install bunyan logger support:  `npm install -g bunyan`
Install httpie (https://github.com/jkbr/httpie): `easy_install httpie`

#### SSH to get private repositories and private dependencies via git/npm
- get your ssh keypair (if you do not have an ssh keypair, [create one](https://help.github.com/articles/generating-ssh-keys)
  or ask reto/boris to help)
- upload your public key into your github account: [step 3/4 in this guide](https://help.github.com/articles/generating-ssh-keys) 

### Getting Started
    git clone https://github.com/YouPers/yp-backend.git
    cd yp-backend
    npm install   // installs all needed software for build system: defined in package.json)
    bin/resettestdb.sh

### Build commands:

    grunt
tests, compiles and builds the distribution version of the whole project, is used by CI
is executing "grunt jshint", "grunt test"

    grunt server | bunyan
runs the server, watches all files, restarts a server on filechange on localhost:8000

    grunt test
Starts a server, runs the testsuite once, and stops the server. Used by continuous integration.

    grunt testdebug
Only runs the testsuite once, expects a running server on port 8000, useful when running a server with a running debugger
in the IDE

    grunt servertest
for TDD, starts a server and runs the testsuite, then watches all files an restarts server when needed and reruns
testsuite whenever changes occur


### executing backend calls

use httpie as your development tool on the command line. This tool allows you to see easily what is going on with the backend.
It is very easy to test your new API calls, to pass JSON or to pass parameters!
Detailed doc: https://github.com/jkbr/httpie

    http -v GET localhost:8000/activities
    http -a username:password -v POST localhost:8000/users username=newusername password=newpassword fullname=Reto Blunschi

### Continuous Deployment to Heroku:

CircleCI automatically deploys this project to the respective server instance, depending on the branch being built

Heroku uses:

- "ci" environmont (see config.js) for the master branch, deploys to https://cimaster.youpers.com
- "uat" environment (see config.js) for the uat branch, deploys to https://uat.youpers.com

## Logging and Debugging

The backend server uses the restify/bunyan integration for logging. These logs provide information that
helps debugging backend problems. For more detailled info see: https://github.com/trentm/node-bunyan

Logging options are configured in config/config.js. Default for the development environment is:

- log info level to console
- log debug level to logs/server.log

use the following commands:
Running log in a terminal window showing all requests and responses

    tail -f logs/server.log |Â bunyan

The backend adds a special header request-id to every respond it sends to the client. With this response-id you
can search for all related log messages in the server.log, so you easily find detailled error logs for your request.

    cat logs/server.log | bunyan -c 'this.req_id == "66ad5bb0-7c97-11e3-aa24-d347df5b222e"'

## API Documentation

The API documentation is autogenerated and provided as a Website using tooling from  [swagger](https://developers.helloreverb.com/swagger/).

### Prerequisites:
- you have your local backend running at localhost:8000

### Installation
In order to display the documentation from the locally running Backend during development follow these steps:

- clone this github repo: https://github.com/YouPers/swagger-ui.git
- cd swagger-ui
- npm install
- node web.js
- open your preferred browser and go to localhost:5000 and enjoy the API documenation.

In order to see the API documentation of a deployed instance of the backend, you can either use your local swagger-ui (see
above) and just enter the backend-URL in the input-box on top. Or you can use a public swagger site like:
[swagger public](http://petstore.swagger.wordnik.com/) and enter the YouPers Backend-URL into the input box on
top e.g. https://uat.youpers.com/api-docs

The Documentation site is always using the user: unittest and password: test when it calls the backend.


## Release History
_(Nothing yet)_

## License
Copyright (c) 2014 YouPers AG
